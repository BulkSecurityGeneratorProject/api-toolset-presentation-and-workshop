<html>

<head>
	<title>A API-Platform Team Presentation</title>
	<meta charset="utf-8">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<script src="https://kit.fontawesome.com/4b32f4e53d.js">
	</script>
	<style>
		@import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
		@import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);
		@import url(https://fonts.googleapis.com/css?family=Roboto+Mono:700);
		@import url(https://fonts.googleapis.com/css?family=PT+Mono);
		@import url(https://fonts.googleapis.com/css?family=Major+Mono+Display);
		@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:700,400);
		@import url(https://fonts.googleapis.com/css?family=Crimson+Text);
		@import url(https://fonts.googleapis.com/css?family=Exo+2);

		body {
			font-family: 'Crimson Text';
		}

		.remark-slide-content {
			font-size: 20px;
		}

		.remark-code,
		.remark-inline-code {
			font-family: 'Ubuntu Mono';
		}

		.remark-code-line-highlighted {
			background-color: #373832;
		}


		h1,
		h2,
		h3 {
			font-family: 'Exo 2';
			font-weight: normal;
		}

		code {
			background: #e7e8e2;
			border-radius: 5px;
		}

		li p {
			line-height: 1.25em;
		}

		.red {
			color: #fa0000;
		}

		.large {
			font-size: 2em;
		}

		a,
		a>code {
			color: rgb(249, 38, 114);
			text-decoration: none;
		}

		.remark-slide-content:after {
			content: "";
			position: absolute;
			bottom: 10px;
			right: 40px;
			height: 40px;
			width: 120px;
			background-repeat: no-repeat;
			background-size: contain;
			background-image: url('');
		}

		.remark-slide-content h1 {
			font-size: 3em;
		}

		.remark-slide-content h2 {
			font-size: 2em;
		}

		.remark-slide-content h3 {
			font-size: 1.6em;
		}

		.footnote {
			position: absolute;
			bottom: 3em;
		}

		li p {
			line-height: 1.25em;
		}

		.red {
			color: #fa0000;
		}

		.large {
			font-size: 2em;
		}

		a,
		a>code {
			color: rgb(249, 38, 114);
			text-decoration: none;
		}

		code {
			background: #e7e8e2;
			border-radius: 5px;
		}

		.remark-code-line-highlighted {
			background-color: #373832;
		}

		.pull-left {
			float: left;
			width: 47%;
		}

		.pull-right {
			float: right;
			width: 47%;
		}

		.pull-right~p {
			clear: both;
		}

		#slideshow .slide .content code {
			font-size: 0.8em;
		}

		#slideshow .slide .content pre code {
			font-size: 0.9em;
			padding: 15px;
		}

		.inverse {
			background: #272822;
			color: #777872;
			text-shadow: 0 0 20px #333;
		}

		.inverse h1,
		.inverse h2 {
			color: #f3f3f3;
			line-height: 0.8em;
		}

		/* Slide-specific styling */
		#slide-inverse .footnote {
			bottom: 12px;
			left: 20px;
		}

		#slide-how .slides {
			font-size: 0.9em;
			position: absolute;
			top: 151px;
			right: 140px;
		}

		#slide-how .slides h3 {
			margin-top: 0.2em;
		}

		#slide-how .slides .first,
		#slide-how .slides .second {
			padding: 1px 20px;
			height: 90px;
			width: 120px;
			-moz-box-shadow: 0 0 10px #777;
			-webkit-box-shadow: 0 0 10px #777;
			box-shadow: 0 0 10px #777;
		}

		#slide-how .slides .first {
			background: #fff;
			position: absolute;
			top: 20%;
			left: 20%;
			z-index: 1;
		}

		#slide-how .slides .second {
			position: relative;
			background: #fff;
			z-index: 0;
		}

		.remark-slide-number {
			font-size: 10pt;
			margin-bottom: -4rpx;
			margin-right:0px;
			color: #272822;
			opacity: 1;
			/* default: 0.5 */
		}

		/* Two-column layout */
		.left-column {
			color: #777;
			width: 40%;
			height: 92%;
			float: left;
		}

		.left-column h2:last-of-type,
		.left-column h3:last-child {
			color: #000;
		}

		.right-column {
			width: 55%;
			height: 92%;
			float: right;
		}

		iframe {
			display: block;
			width: 100%;
			height: 490px;
			#height: 100vh;
		}
	</style>
</head>

<body>
	<textarea id="source">
name: inverse
layout: true
class: inverse, middle
---

<center>
###<a href="#"><i class="fas fa-screwdriver"></i> __Workshop__</a>

# Build a <br>Microservice and <br>a Mock-Server

### from a given OpenAPI-Specification
</center>
<br/>
<br/>
<br/>
```text
                           _        _      _    __
                 __ _ _ __(_)  _ __| |__ _| |_ / _|___ _ _ _ __
                / _` | '_ \ | | '_ \ / _` |  _|  _/ _ \ '_| '  \
                \__,_| .__/_| | .__/_\__,_|\__|_| \___/_| |_|_|_|
                   |_|      |_|             (c) api platform team
```
---
layout: false

.left-column[
  ## <i class="fas fa-project-diagram"></i> __What__
  ## __we will do__
]

.right-column[
<div class="mermaid" style="text-align: center; height: 100%; padding-top:25px">
graph TD
A[OpenAPI Specification] -- OpenAPI Generator --> B[Generated Source Code]
B --Implementation Of Generated Interfaces --> C[API-Service]
C -- Generation of WireMock Stubs --> D[Working WireMock]
</div>
]

---

.left-column[
  ## <i class="fas fa-tools"></i> __What__
  ## __we will use__
]

.right-column[
<br>
### - __SpringBoot__
### - __Maven (and Plugins)__
### - __OpenAPI-Generator__
### - __SpringFox__
### - __SwaggerUI__
### - __WireMock__
### - __Gitpod__

]

---

.left-column[
  ## <i class="fas fa-clipboard-list"></i> __What__
  ## __we need__
]

.right-column[
<br>
<br>
<br>
<br>
<br>
<br>
### - __Github-Account*__
### - __Chrome or Firefox__

.footnote[.red[*] free to join __https://github.com/join__]
]

---

.left-column[
  ## <i class="fas fa-desktop"></i> __Gitpod__
  ### __Online Development Environment__
  #### we will use for this showcase

  __https://gitpod.io__ (from Typefox, Kiel)

  The Browser IDE is based on<br> __Visual Studio Code__
]

.right-column[

<div class="mermaid"  style="text-align: center; height: 100%; padding-top:25px">
graph TD
A(Github Reposiroty) -- checkout & configuration --> B(Gitpod.io)
B -- start --> C(Java Language Server)
B -- start --> D(Docker Container)
D --> E(Browser IDE)
C --> E
</div>

]

---
<br>
### <i class="fas fa-play-circle"></i> __Start the online IDE__

__Open__ this URL in your (Chrome) Browser:

#### __https://gitpod.io#https://github.com/mrussmann/jhipster-ms-showcase__


and __login__ with your  <i class="fab fa-github"></i> Github account.


The IDE should be starting up and check out all the sources we need.

---
<br>
### <i class="fas fa-folder-open"></i> Open the (given) __OpenAPI-specification__

```bash
 open /workspace/jhipster-ms-showcase/jhipster-api-service/
        src/main/resources/swagger/productapi.yml
```

```yaml
swagger: '2.0' # OpenAPI-Version
info:  # Metadata
  version: 0.0.1
  title: ProductAPI
  description: A very simple product API
basePath: /api # relative base-path of your API
paths: # defines the endpoints
  /products: # /api/products
    get: # REST Method
      description: Returns
      operationId: getProducts # optional
...
```
---
<br>
### <i class="fas fa-cogs"></i> Generate __source code__
### from the __OpenAPI specification__

Copy the specification (productapi.yml) file into your project:

```bash
cp /workshop/productapi.yml
    /jhipster-api-service/src/main/resources/swagger/
```

---

### <i class="fas fa-edit"></i> Edit the __Maven__ (pom.xml) file
#### to generate the sourcecode with the openapi-generator plugin

```xml
<plugin>
    <groupId>org.openapitools</groupId>
    <artifactId>openapi-generator-maven-plugin</artifactId>
    <version>${openapi-generator-maven-plugin.version}</version>
    <executions>
        <execution>
            <goals>
                <goal>generate</goal>
            </goals>
            <configuration>
*               <inputSpec>${project.basedir}/src/
*                              main/resources/swagger/productapi.yml</inputSpec>
                <generatorName>spring</generatorName>
                <apiPackage>de.axa.api.platform.web.api</apiPackage>
                <modelPackage>de.axa.api.platform.web.api.model</modelPackage>
                <validateSpec>true</validateSpec>
                <configOptions>
                    <delegatePattern>true</delegatePattern>
                    <title>apiservice</title>
                </configOptions>
            </configuration>
        </execution>
    </executions>
</plugin>
```
---
#### now, generate the sources with the maven goal:


```bash
./mvnw generate-sources
```

#### The following files were generated:

```bash
[INFO] writing file /workspace/jhipster-ms-showcase/jhipster-api-service/target/
    generated-sources/openapi/
        src/main/java/de/axa/api/platform/web/api/model/Product.java
[INFO] writing file /workspace/jhipster-ms-showcase/jhipster-api-service/target/
    generated-sources/openapi/
        src/main/java/de/axa/api/platform/web/api/ProductsApiController.java
[INFO] writing file /workspace/jhipster-ms-showcase/jhipster-api-service/target/
    generated-sources/openapi/
        src/main/java/de/axa/api/platform/web/api/ProductsApi.java
[INFO] writing file /workspace/jhipster-ms-showcase/jhipster-api-service/target/
    generated-sources/openapi/
        src/main/java/de/axa/api/platform/web/api/ProductsApiDelegate.java
```
#### open them in the IDE and have a look ...

---
<br>
### <i class="fas fa-running"></i> Start the __API-Service__

```bash
cd /workspace/jhipster-ms-showcase/jhipster-api-service
./mvnw spring-boot:run
```

the API-service will start on port __8081__ and make a request against the API-service

```bash
curl -X GET localhost:8081/api/products
```

or use the SwaggerUI which will open automatically in the IDE after the service is started

---

###  <i class="fab fa-java" style="color: black"></i> Write a __ProductService__
#### which implements the generated ProductsApiDelegate-Interface

```java

package de.axa.api.platform.service;

import de.axa.api.platform.web.gen.api.ProductsApiDelegate;
import de.axa.api.platform.web.gen.api.model.Product;

import java.util.ArrayList;
import java.util.List;
import java.math.BigDecimal;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;


@Service
public class ProductService implements ProductsApiDelegate{
    private static final Logger log = LoggerFactory.getLogger(ProductService.class);

     @Override
    public ResponseEntity<List<Product>> getProducts(Integer maxInteger) {
          // your code goes here
    }
}

```

---

### <i class="fas fa-file-signature"></i> Write a __Contract Definition__
#### in the Spring Cloud Contract DSL

```bash
/workspace/jhipster-ms-showcase/jhipster-api-service/src/test/
    resources/contracts/productapi.yml
```
#### Template
```yaml
description: "should return a list of products"
request:
  method: GET
  url: /api/products
response:
  status: 200
  headers:
    content-type: application/json;charset=UTF-8
  body: [
         // JSON to return
    ]

```

---

### <i class="fas fa-cogs"></i> Generate the WireMock specific contract stubs
#### from the just written contract files:

```bash
./mvnw spring-cloud-contract:convert
```
#### from the just generated .json files and creates a jar
```bash
./mvnw spring-cloud-contract:generateStubs
```
#### generate integration tests
```bash
./mvnw spring-cloud-contract:generateTests
```

---

### <i class="fas fa-copy"></i> Copy the generated WireMock contracts
#### into the WireMock mapping directory

```bash
cp /workspace/jhipster-ms-showcase/jhipster-api-service/target/stubs/META-INF/de.axa.api.platform/apiservice/0.0.1-SNAPSHOT/mappings/*.json /workspace/jhipster-ms-showcase/wiremock/mappings/
```


### <i class="fas fa-running"></i> Start the __WireMock__
#### on port 8082

```bash
  cd /workspace/jhipster-ms-showcase/wiremock
  _JAVA_OPTIONS="-Xmx1G" java -jar wiremock-standalone-2.23.2.jar --port 8082
```

---

### <i class="fas fa-share-square"></i> Request the __WireMock__

#### with curl

```bash
curl -X GET localhost:8082/api/products
```

#### to compare

#### request the development server

```bash
curl -X GET localhost:8081/api/products
```
<br>

#### <i class="fas fa-arrow-circle-right"></i> now we (should) also have a working mock server for your development system <i class="fas fa-pray"></i>

.footnote[<i class="fas fa-stop-circle"></i> .red[__that's all for now folks__ ]]

</textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/7.0.0/mermaid.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mermaid/7.0.0/mermaid.css">
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script>
      var slideshow = remark.create({
          highlightStyle: 'monokai',
          highlightLanguage: 'remark',
          highlightLines: true
        }) ;

      mermaid.initialize({
        startOnLoad: false,
        cloneCssStyles: false,
        });

    function initMermaidInSlide(slide) {
        var slideIndex = slide.getSlideIndex();
        // caution: no API to get the DOM element of current slide in remark, this might break in the future
        var currentSlideElement = document.querySelectorAll(".remark-slides-area .remark-slide")[slideIndex];
        var currentSlideMermaids = currentSlideElement.querySelectorAll(".mermaid");
        if (currentSlideMermaids.length !== 0) {
        mermaid.init(undefined, currentSlideMermaids);
        }
    }

    // first starting slide won't trigger the slide event, manually init mermaid
    initMermaidInSlide(slideshow.getSlides()[slideshow.getCurrentSlideIndex()])
    // on each slide event, trigger init mermaid
    slideshow.on('afterShowSlide', initMermaidInSlide);

    </script>

  </body>
    -->
</html>